<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Image Chat Test</title>
</head>
<body style="background:#111;color:white;font-family:sans-serif">

<h3>TEST KIRIM GAMBAR</h3>

<input type="file" id="img" accept="image/*">
<button id="send">KIRIM</button>

<div id="log"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } 
from "https://www.gstatic.com/firebasejs/10.13.2/firebase-storage.js";

const app = initializeApp({
  apiKey: "AIzaSyBbxBR_AiOSsWdgYP0LrjvLDuyFUOJ9yH8",
  databaseURL: "https://jiyy-chat-default-rtdb.asia-southeast1.firebasedatabase.app"
});

const db = getDatabase(app);
const storage = getStorage(app);

document.getElementById("send").onclick = async () => {
  const file = document.getElementById("img").files[0];
  if(!file) return alert("pilih gambar");

  const r = sRef(storage,"test/"+Date.now()+"_"+file.name);
  await uploadBytes(r,file);
  const url = await getDownloadURL(r);

  push(ref(db,"imgTest"),{
    img:url,
    time:Date.now()
  });
};

onValue(ref(db,"imgTest"),snap=>{
  document.getElementById("log").innerHTML="";
  snap.forEach(s=>{
    const d=s.val();
    document.getElementById("log").innerHTML +=
      `<img src="${d.img}" style="max-width:200px;display:block;margin:10px 0">`;
  });
});
</script>
</body>
</html>
