<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jiyy Eazy — Visitor Counter</title>

  <!-- Meta / theme -->
  <meta name="theme-color" content="#0f172a">
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- GSAP CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <style>
    /* ========== BASE + THEME ========== */
    :root{
      --bg:#0b1220;
      --panel:#0f172a;
      --muted:#98a0b3;
      --accent:#7c5cff;
      --glass: rgba(255,255,255,0.04);
      --card-shadow: 0 8px 30px rgba(2,6,23,0.6);
      --glass-2: rgba(255,255,255,0.03);
      --accent-2:#22c1c3;
      color-scheme: dark;
    }
    [data-theme="light"] {
      --bg:#f6f8fb;
      --panel:#ffffff;
      --muted:#6b7280;
      --accent:#6b21a8;
      --glass: rgba(12,18,30,0.03);
      --card-shadow: 0 8px 30px rgba(18,20,30,0.08);
      --accent-2:#059669;
      --glass-2: rgba(2,6,23,0.02);
      color-scheme: light;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(124,92,255,0.12), transparent 6%),
        radial-gradient(900px 400px at 90% 90%, rgba(34,193,195,0.06), transparent 8%),
        var(--bg);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: #e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:32px;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      gap:24px;
    }

    /* Container */
    .container{
      width:100%;
      max-width:1100px;
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:20px;
      align-items:start;
    }
    @media (max-width:900px){
      .container{grid-template-columns:1fr; padding-bottom:60px}
    }

    /* Left panel (branding + counter + controls) */
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), var(--glass));
      border-radius:18px;
      padding:20px;
      box-shadow:var(--card-shadow);
      backdrop-filter: blur(8px) saturate(120%);
      border: 1px solid rgba(255,255,255,0.03);
    }

    .branding{
      display:flex;
      gap:12px;
      align-items:center;
      margin-bottom:14px;
    }
    .logo{
      width:64px;
      height:64px;
      border-radius:14px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      font-size:20px;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color:white;
      box-shadow: 0 8px 24px rgba(124,92,255,0.18), inset 0 -8px 30px rgba(0,0,0,0.15);
      user-select:none;
    }
    .brand-text{
      line-height:1;
    }
    .brand-text h1{
      margin:0;
      font-size:18px;
      letter-spacing:0.4px;
    }
    .brand-text p{
      margin:0;
      margin-top:4px;
      color:var(--muted);
      font-size:13px;
    }

    /* Visitor big counter */
    .counter-wrap{
      margin-top:8px;
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:center;
      text-align:center;
    }
    .count-number{
      font-size:56px;
      font-weight:800;
      letter-spacing:1px;
      background: linear-gradient(180deg, #fff, rgba(255,255,255,0.7));
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }
    .count-meta{
      color:var(--muted);
      font-size:13px;
    }

    /* Controls */
    .controls{
      display:flex;
      gap:8px;
      margin-top:8px;
      flex-wrap:wrap;
      justify-content:center;
    }
    .btn{
      background:transparent;
      border:1px solid rgba(255,255,255,0.06);
      padding:8px 12px;
      border-radius:10px;
      cursor:pointer;
      color:inherit;
      font-weight:600;
      font-size:13px;
      transition:transform .18s ease, background .18s;
    }
    .btn:hover{transform:translateY(-4px)}
    .btn.primary{
      background: linear-gradient(90deg,var(--accent),var(--accent-2));
      color:white;
      border:0;
      box-shadow: 0 8px 30px rgba(124,92,255,0.12);
    }

    /* Personalization input */
    .personal{
      display:flex;
      gap:8px;
      margin-top:12px;
      align-items:center;
      justify-content:center;
    }
    .personal input{
      padding:10px 12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.04);
      background:transparent;
      color:inherit;
      outline:none;
      min-width:160px;
    }

    /* Right area (chart + details) */
    .right{
      display:flex;
      flex-direction:column;
      gap:18px;
    }

    .card h2{margin:0; font-size:16px}
    .meta-row{display:flex;align-items:center;justify-content:space-between;gap:12px}

    /* Chart area */
    .chart-card{
      padding:18px;
    }
    #chartLegend{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .chip{
      padding:6px 10px;
      border-radius:999px;
      background:var(--glass-2);
      font-size:13px;
      cursor:pointer;
      border:1px solid rgba(255,255,255,0.02);
    }
    .chip.active{
      background: linear-gradient(90deg,var(--accent),var(--accent-2));
      color:white;
      border:0;
      transform:translateY(-2px);
    }

    /* last visit + share area */
    .info-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    .small{
      font-size:13px;
      color:var(--muted);
    }

    /* footer note */
    .note{
      margin-top:6px;
      font-size:12px;
      color:var(--muted);
      text-align:center;
    }

    /* Responsive tweaks */
    @media (max-width:480px){
      .count-number{font-size:40px}
      .logo{width:56px;height:56px}
      .container{padding:12px}
    }

    /* small helper */
    .muted{color:var(--muted); font-size:13px}
  </style>
</head>
<body>
  <div class="container" id="app">
    <!-- LEFT: Branding + Counter -->
    <div class="card" aria-live="polite">
      <div class="branding">
        <div class="logo" id="logo">JE</div>
        <div class="brand-text">
          <h1>Jiyy Eazy</h1>
          <p>Visitor Counter • Interaktif • Modern</p>
        </div>
      </div>

      <!-- Main Counter -->
      <div class="counter-wrap">
        <div class="count-number" id="visitorCount" aria-label="Jumlah Pengunjung">0</div>
        <div class="count-meta" id="greeting">Halo! Selamat datang.</div>

        <!-- Controls -->
        <div class="controls">
          <button class="btn primary" id="incBtn" title="Tambah manual">+ Tambah</button>
          <button class="btn" id="themeToggle" title="Ganti tema">Mode Gelap/Terang</button>
          <button class="btn" id="soundToggle" title="Aktifkan/Nonaktifkan suara">Suara: On</button>
        </div>

        <!-- input nama -->
        <div class="personal" role="form" aria-label="Form Personal">
          <input id="nameInput" type="text" placeholder="Masukkan namamu..." />
          <button class="btn" id="saveName">Simpan</button>
        </div>

        <div class="note" id="lastVisitNote">Kunjungan terakhir: -</div>
      </div>
    </div>

    <!-- RIGHT: Chart + Info -->
    <div class="right">
      <div class="card chart-card">
        <div class="meta-row">
          <h2>Grafik Pengunjung</h2>
          <div>
            <span class="small muted">Mode:</span>
            <span id="modeLabel" class="small">Harian</span>
          </div>
        </div>

        <!-- Canvas for Chart.js -->
        <canvas id="visitorChart" height="120"></canvas>

        <!-- chart controls -->
        <div id="chartLegend">
          <button class="chip active" data-mode="daily">Harian</button>
          <button class="chip" data-mode="weekly">Mingguan</button>
          <button class="chip" data-mode="monthly">Bulanan</button>
        </div>
      </div>

      <!-- Info + Sharing -->
      <div class="card">
        <div class="meta-row" style="align-items:center">
          <div>
            <h2>Informasi Kunjungan</h2>
            <div class="small">Data disimpan di device (localStorage).</div>
          </div>
          <div style="text-align:right">
            <div class="small">Tema saat ini:</div>
            <div id="currentTheme" class="muted">-</div>
          </div>
        </div>

        <div style="margin-top:12px" class="info-grid">
          <div>
            <div class="small">Nama Pengunjung</div>
            <div id="displayName" style="font-weight:700">-</div>
          </div>
          <div>
            <div class="small">Kunjungan terakhir</div>
            <div id="lastVisit" style="font-weight:700">-</div>
          </div>
        </div>

        <div style="margin-top:16px; display:flex; gap:8px; justify-content:center; flex-wrap:wrap">
          <button class="btn" id="shareTwitter">Bagikan ke Twitter</button>
          <button class="btn" id="shareFacebook">Bagikan ke Facebook</button>
        </div>

        <div style="margin-top:12px" class="note">
          Efek suara saat angka bertambah & animasi GSAP aktif.
        </div>
      </div>

      <div style="text-align:center" class="muted">© <strong>Jiyy Eazy</strong> • Demo</div>
    </div>
  </div>

  <!-- ====== JAVASCRIPT: Logic, localStorage, Chart.js, GSAP, Sound ====== -->
  <script>
    /* ---------------------
       Utility: tanggal format
       --------------------- */
    function formatDateTime(ts) {
      const d = new Date(ts);
      const pad = n => String(n).padStart(2,'0');
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    }

    /* ---------------------
       STORAGE KEYS
       --------------------- */
    const LS_KEYS = {
      total: 'jiyy_total_visitors',
      name: 'jiyy_name',
      theme: 'jiyy_theme',
      lastVisit: 'jiyy_last_visit',
      history: 'jiyy_history' // store per-date counts: { "2025-12-03": 5, ... }
    };

    /* ---------------------
       INITIALIZATION
       --------------------- */
    // DOM elements
    const visitorCountEl = document.getElementById('visitorCount');
    const greetingEl = document.getElementById('greeting');
    const lastVisitNoteEl = document.getElementById('lastVisitNote');
    const lastVisitEl = document.getElementById('lastVisit');
    const nameInputEl = document.getElementById('nameInput');
    const displayNameEl = document.getElementById('displayName');
    const saveNameBtn = document.getElementById('saveName');
    const themeToggleBtn = document.getElementById('themeToggle');
    const currentThemeEl = document.getElementById('currentTheme');
    const modeLabelEl = document.getElementById('modeLabel');
    const soundToggleBtn = document.getElementById('soundToggle');
    const incBtn = document.getElementById('incBtn');

    // Load from localStorage or set defaults
    let total = Number(localStorage.getItem(LS_KEYS.total) || 0);
    let storedName = localStorage.getItem(LS_KEYS.name) || '';
    let theme = localStorage.getItem(LS_KEYS.theme) || 'dark';
    let lastVisit = localStorage.getItem(LS_KEYS.lastVisit) || null;
    let history = JSON.parse(localStorage.getItem(LS_KEYS.history) || '{}');

    // Apply theme to document
    document.documentElement.setAttribute('data-theme', theme);
    currentThemeEl.textContent = theme === 'light' ? 'Terang' : 'Gelap';
    soundToggleBtn.textContent = 'Suara: On';

    // Set name if exists
    if (storedName) {
      displayNameEl.textContent = storedName;
      nameInputEl.value = storedName;
      greetingEl.textContent = `Halo, ${storedName}! Selamat datang di Jiyy Eazy.`;
    }

    // Last visit display
    if (lastVisit) {
      lastVisitEl.textContent = formatDateTime(Number(lastVisit));
      lastVisitNoteEl.textContent = `Kunjungan terakhir: ${formatDateTime(Number(lastVisit))}`;
    } else {
      lastVisitEl.textContent = '-';
    }

    /* ---------------------
      Increment visitor on page open
      - Requirement: otomatis bertambah setiap kali halaman dibuka.
      - We will increment total and update today's date count in history
      --------------------- */
    function incrementVisitor(by=1, animate=true) {
      const prev = total;
      total += by;
      localStorage.setItem(LS_KEYS.total, String(total));

      // Update today's bucket in history
      const todayKey = (new Date()).toISOString().slice(0,10); // YYYY-MM-DD
      history = JSON.parse(localStorage.getItem(LS_KEYS.history) || '{}');
      history[todayKey] = (history[todayKey] || 0) + by;
      localStorage.setItem(LS_KEYS.history, JSON.stringify(history));

      // Update last visit timestamp
      const now = Date.now();
      localStorage.setItem(LS_KEYS.lastVisit, String(now));
      lastVisit = String(now);
      lastVisitNoteEl.textContent = `Kunjungan terakhir: ${formatDateTime(now)}`;
      lastVisitEl.textContent = formatDateTime(now);

      // UI: animate numeric change
      animateCount(prev, total, animate);

      // play sound
      if (soundOn) {
        playPing();
      }

      // refresh chart with new data
      updateChart();
    }

    /* ---------------------
      Animated number change using GSAP
      --------------------- */
    function animateCount(from, to, animate=true) {
      // If animate is false just set immediately
      if (!animate) { visitorCountEl.textContent = String(to); return; }

      // Use GSAP to animate a number tween
      const obj = {val: from};
      gsap.to(obj, {
        val: to,
        duration: 1,
        ease: "power2.out",
        onUpdate() {
          visitorCountEl.textContent = Math.floor(obj.val).toLocaleString();
        },
        onComplete() {
          visitorCountEl.textContent = to.toLocaleString();
          // a small pulse for emphasis
          gsap.fromTo(visitorCountEl, {scale:1}, {scale:1.06, duration:0.14, yoyo:true, repeat:1, ease:'power1.inOut'});
        }
      });
    }

    /* ---------------------
       SOUND: Simple click/ping via WebAudio API
       - No external files; create oscillator beep
       --------------------- */
    let audioCtx = null;
    let soundOn = true;
    function playPing() {
      try {
        if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = 'sine';
        o.frequency.value = 780; // frequency in Hz
        g.gain.value = 0.0001;
        o.connect(g);
        g.connect(audioCtx.destination);
        const now = audioCtx.currentTime;
        g.gain.setValueAtTime(0.0001, now);
        g.gain.exponentialRampToValueAtTime(0.08, now+0.02);
        o.start(now);
        g.gain.exponentialRampToValueAtTime(0.0001, now+0.25);
        o.stop(now+0.26);
      } catch (e) {
        console.warn('Audio not supported or user gesture required', e);
      }
    }

    soundToggleBtn.addEventListener('click', () => {
      soundOn = !soundOn;
      soundToggleBtn.textContent = `Suara: ${soundOn ? 'On' : 'Off'}`;
    });

    /* ---------------------
       Save name input
       --------------------- */
    saveNameBtn.addEventListener('click', () => {
      const val = nameInputEl.value.trim();
      if (!val) return alert('Masukkan nama terlebih dahulu.');
      storedName = val;
      localStorage.setItem(LS_KEYS.name, storedName);
      displayNameEl.textContent = storedName;
      greetingEl.textContent = `Halo, ${storedName}! Selamat datang di Jiyy Eazy.`;
      // small animation to highlight change
      gsap.fromTo(displayNameEl, {x:-6, opacity:0.6}, {x:0, opacity:1, duration:0.5, ease:'power2.out'});
    });

    /* ---------------------
       Theme toggle
       --------------------- */
    themeToggleBtn.addEventListener('click', () => {
      theme = (theme === 'dark') ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem(LS_KEYS.theme, theme);
      currentThemeEl.textContent = theme === 'light' ? 'Terang' : 'Gelap';
      // subtle animation
      gsap.fromTo(document.body, {opacity:0.94}, {opacity:1, duration:0.35});
    });

    /* ---------------------
       Manual increment button (for demo)
       --------------------- */
    incBtn.addEventListener('click', () => {
      incrementVisitor(1, true);
    });

    /* ---------------------
       Share buttons (Twitter / Facebook)
       - Open share URL in new window
       --------------------- */
    document.getElementById('shareTwitter').addEventListener('click', () => {
      const text = encodeURIComponent('Lihat visitor counter keren ini — Jiyy Eazy!');
      const url = encodeURIComponent(location.href);
      const shareUrl = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;
      window.open(shareUrl,'_blank','noopener');
    });

    document.getElementById('shareFacebook').addEventListener('click', () => {
      const url = encodeURIComponent(location.href);
      const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
      window.open(shareUrl,'_blank','noopener');
    });

    /* ---------------------
       CHART.JS: Setup and update functions
       - Use history object stored in localStorage
       - Provide daily / weekly / monthly modes
       --------------------- */
    const ctx = document.getElementById('visitorChart').getContext('2d');

    // Default Chart.js config
    const baseConfig = {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Pengunjung',
          data: [],
          fill:true,
          tension:0.35,
          pointRadius:4,
          pointHoverRadius:6,
          borderWidth:2,
          backgroundColor: createGradient()
        }]
      },
      options: {
        responsive:true,
        maintainAspectRatio:false,
        plugins:{
          legend:{display:false},
          tooltip:{mode:'index', intersect:false}
        },
        scales: {
          x: { grid: {display:false}, ticks: {color: 'var(--muted)'} },
          y: { grid: {color:'rgba(255,255,255,0.03)'}, ticks: {color:'var(--muted)', beginAtZero:true} }
        }
      }
    };

    // Helper to create gradient for chart fill (uses current canvas)
    function createGradient() {
      try {
        const g = ctx.createLinearGradient(0,0,0,200);
        // colors follow CSS variables -- we can't directly read gradient objects, but we pick soft colors
        g.addColorStop(0, 'rgba(124,92,255,0.26)');
        g.addColorStop(1, 'rgba(34,193,195,0.04)');
        return g;
      } catch (e) {
        return 'rgba(124,92,255,0.12)';
      }
    }

    let visitorChart = new Chart(ctx, baseConfig);

    // Get array of last N dates
    function getLastNDates(n) {
      const arr = [];
      for (let i = n-1; i >= 0; i--) {
        const d = new Date();
        d.setDate(d.getDate() - i);
        arr.push(d.toISOString().slice(0,10));
      }
      return arr;
    }

    // Prepare chart data for daily/weekly/monthly
    function prepareChartData(mode='daily') {
      const raw = JSON.parse(localStorage.getItem(LS_KEYS.history) || '{}');
      const labels = [];
      const data = [];

      if (mode === 'daily') {
        const dates = getLastNDates(14); // last 14 days
        dates.forEach(date => {
          labels.push(date.slice(5)); // MM-DD to shorten
          data.push(raw[date] || 0);
        });
      } else if (mode === 'weekly') {
        // last 12 weeks: sum per week (Mon-Sun)
        const today = new Date();
        const resLabels = [];
        const resData = [];
        for (let w=11; w>=0; w--) {
          const d = new Date();
          d.setDate(today.getDate() - w*7);
          const start = new Date(d);
          start.setDate(d.getDate() - d.getDay()); // start of week (Sunday)
          let sum = 0;
          for (let i=0;i<7;i++){
            const x = new Date(start);
            x.setDate(start.getDate()+i);
            const key = x.toISOString().slice(0,10);
            sum += Number(raw[key] || 0);
          }
          resLabels.push(`${start.toISOString().slice(5,10)}`);
          resData.push(sum);
        }
        return {labels:resLabels, data:resData};
      } else if (mode === 'monthly') {
        // last 6 months
        const now = new Date();
        for (let m=5; m>=0; m--){
          const d = new Date(now.getFullYear(), now.getMonth()-m, 1);
          const monthKey = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
          let sum = 0;
          // iterate over days of that month
          const next = new Date(d.getFullYear(), d.getMonth()+1, 1);
          for (let day = new Date(d); day < next; day.setDate(day.getDate()+1)){
            const k = day.toISOString().slice(0,10);
            sum += Number(raw[k] || 0);
          }
          labels.push(monthKey);
          data.push(sum);
        }
      }

      return {labels, data};
    }

    // Update chart with a mode
    let currentMode = 'daily';
    function updateChart(mode=currentMode) {
      currentMode = mode;
      modeLabelEl.textContent = mode === 'daily' ? 'Harian' : (mode === 'weekly' ? 'Mingguan' : 'Bulanan');

      const prepared = prepareChartData(mode);
      // Update dataset
      visitorChart.data.labels = prepared.labels;
      visitorChart.data.datasets[0].data = prepared.data;
      visitorChart.data.datasets[0].backgroundColor = createGradient();
      visitorChart.update('active');
      // subtle entrance animation via GSAP on canvas element
      gsap.fromTo(document.getElementById('visitorChart'), {y:8, opacity:0.85}, {y:0, opacity:1, duration:0.6, ease:'power2.out'});
    }

    // Chart mode buttons
    document.querySelectorAll('.chip').forEach(c => {
      c.addEventListener('click', e => {
        document.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
        c.classList.add('active');
        const mode = c.getAttribute('data-mode');
        updateChart(mode);
      });
    });

    /* ---------------------
       INITIAL UI SETUP
       --------------------- */
    // show initial total without animation
    animateCount(total, total, false);

    // Put initial values on load
    if (storedName) {
      displayNameEl.textContent = storedName;
      greetingEl.textContent = `Halo, ${storedName}! Selamat datang di Jiyy Eazy.`;
    }

    // Initial increment (page opened)
    // We run incrementVisitor after a short delay to allow UI to initialize and let animations be visible
    window.addEventListener('load', () => {
      // Auto-increment by 1 on each page open
      setTimeout(()=> incrementVisitor(1, true), 300);
      // Build chart
      updateChart('daily');
      // Logo entrance
      gsap.from('#logo', {scale:0.8, opacity:0, duration:0.8, ease:'elastic.out(1,0.6)'});
      gsap.from('.card', {y:12, opacity:0, duration:0.6, stagger:0.06, ease:'power2.out'});
    });

    /* ---------------------
       Accessibility: update aria-live text when count changes
       --------------------- */
    const observer = new MutationObserver(() => {
      visitorCountEl.setAttribute('aria-label', `Jumlah pengunjung ${visitorCountEl.textContent}`);
    });
    observer.observe(visitorCountEl, {childList:true, characterData:true, subtree:true});

    /* ---------------------
       Extra: small anti-cheat/display niceties
       - Format numbers with thousands separators
       --------------------- */
    function formatNumber(n){ return n.toLocaleString(); }

    // expose to console for testing (dev convenience)
    window.JiyyEazy = {
      incrementVisitor,
      getTotal: ()=> total,
      resetAll: ()=> {
        if (confirm('Reset semua data lokal (localStorage)?')) {
          Object.values(LS_KEYS).forEach(k=>localStorage.removeItem(k));
          location.reload();
        }
      }
    };

    /* ======================
       END OF SCRIPT
       ====================== */
  </script>
</body>
</html>
